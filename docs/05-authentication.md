# 5. نظام المصادقة (Authentication)

## النهج الحالي: المصادقة من جانب العميل (غير آمن)

نظام المصادقة في هذا التطبيق مسؤول عن التحقق من هوية المستخدمين، مما يسمح لهم بتسجيل الدخول وإنشاء حسابات جديدة. يتم كل هذا من جانب العميل (client-side) دون أي اتصال بخادم.

- **`components/Auth.tsx`**: هذا المكون يحتوي على كل الواجهات والمنطق المتعلق بالمصادقة.
- **آلية العمل**: يتم تخزين قائمة المستخدمين وكلمات المرور المجزأة (`SHA-256`) في `localStorage`. عند تسجيل الدخول، تتم مقارنة الهاش المدخل بالهاش المخزن.

### تحذير أمني هام

**هذا النظام غير آمن على الإطلاق للتطبيقات الحقيقية.**
- **التجزئة من جانب العميل**: العملية بأكملها تحدث في متصفح المستخدم ويمكن التلاعب بها.
- **تخزين البيانات**: يمكن لأي شخص لديه وصول إلى المتصفح فتح `localStorage` ورؤية قائمة المستخدمين وكلمات المرور المجزأة.
- **الغرض**: تم تصميم هذا النظام لأغراض تعليمية وتوضيحية فقط، ولتمكين التطبيق من العمل بالكامل بدون خادم.

---

## الخطوة التالية: تطبيق المصادقة الحقيقية (Server-Side)

في تطبيق حقيقي، يجب أن تتم عملية المصادقة بالكامل على الخادم. النهج الأكثر شيوعًا واستخدامًا هو **JSON Web Tokens (JWT)**.

### كيف يعمل نظام المصادقة باستخدام JWT؟

1.  **طلب التسجيل/الدخول (من العميل إلى الخادم)**:
    - المستخدم يدخل بياناته (بريد إلكتروني، كلمة مرور) في الواجهة الأمامية.
    - الواجهة الأمامية ترسل هذه البيانات إلى نقطة نهاية (API endpoint) على الخادم (مثال: `POST /api/auth/login`).

2.  **التحقق وإنشاء التوكن (على الخادم)**:
    - الخادم يستقبل البيانات.
    - يتحقق من صحة كلمة المرور بمقارنتها بالهاش المخزن في قاعدة البيانات (يجب استخدام خوارزمية تجزئة قوية مثل `bcrypt` على الخادم).
    - إذا كانت البيانات صحيحة، يقوم الخادم بإنشاء **JWT**. هذا التوكن هو سلسلة نصية مشفرة تحتوي على معلومات حول المستخدم (مثل `userId`) وتاريخ انتهاء صلاحية.

3.  **إرسال التوكن (من الخادم إلى العميل)**:
    - الخادم يرسل الـ JWT مرة أخرى إلى العميل كجزء من استجابة ناجحة.

4.  **تخزين التوكن (على العميل)**:
    - الواجهة الأمامية تستقبل الـ JWT وتقوم بتخزينه بشكل آمن. الأماكن الشائعة هي `localStorage` أو `HttpOnly cookies`.

5.  **المصادقة على الطلبات اللاحقة (من العميل إلى الخادم)**:
    - في كل طلب لاحق يتطلب مصادقة (مثل جلب بيانات الملف الشخصي)، يقوم العميل بإرفاق الـ JWT في ترويسة الطلب (Authorization Header).
    - مثال: `Authorization: Bearer <your_jwt_here>`

6.  **التحقق من التوكن (على الخادم)**:
    - مع كل طلب، يقوم الخادم بالتحقق من صحة وتوقيع الـ JWT.
    - إذا كان التوكن صالحًا، يعرف الخادم من هو المستخدم ويسمح بتنفيذ الطلب.

### لماذا هذا أفضل؟

- **الأمان**: كلمات المرور لا تغادر الخادم أبدًا. المنطق كله يتم في بيئة آمنة.
- **Stateless (عديم الحالة)**: الخادم لا يحتاج إلى تخزين معلومات الجلسة. كل المعلومات التي يحتاجها للتحقق من المستخدم موجودة داخل الـ JWT.
- **قابلية التوسع**: يعمل بشكل جيد مع البنى الموزعة (distributed architectures) و microservices.

للحصول على تفاصيل تقنية حول كيفية بناء هذه الواجهات البرمجية، راجع **[دليل تكامل الواجهة الخلفية](./09-backend-integration.md)**.