# 5. نظام المصادقة (Authentication)

نظام المصادقة في هذا التطبيق مسؤول عن التحقق من هوية المستخدمين، مما يسمح لهم بتسجيل الدخول وإنشاء حسابات جديدة. يتم كل هذا من جانب العميل (client-side) دون أي اتصال بخادم.

## المكون المسؤول

- **`components/Auth.tsx`**: هذا المكون يحتوي على كل الواجهات والمنطق المتعلق بالمصادقة.

## آلية العمل

### 1. تخزين المستخدمين
- يتم تخزين قائمة بجميع المستخدمين المسجلين في `localStorage` تحت مفتاح `'users'`.
- كل كائن `User` في هذه القائمة يحتوي على `userId`, `name`, `email` أو `phone`، و `hashedPassword`.

### 2. إنشاء حساب جديد (Signup)
1.  **جمع البيانات**: يجمع المكون `Auth.tsx` اسم المستخدم، البريد الإلكتروني/الهاتف، وكلمة المرور من النموذج.
2.  **التحقق من التكرار**: قبل إنشاء حساب جديد، يتم البحث في قائمة `users` للتأكد من أن البريد الإلكتروني أو رقم الهاتف غير مسجل مسبقًا.
3.  **تجزئة كلمة المرور (Password Hashing)**:
    - **مهم**: لا نقوم أبدًا بتخزين كلمة المرور كنص عادي.
    - نستخدم `Web Crypto API` المدمجة في المتصفح لتجزئة كلمة المرور باستخدام خوارزمية `SHA-256`.
      ```javascript
      // وظيفة hashPassword في Auth.tsx
      async function hashPassword(password: string): Promise<string> {
          const encoder = new TextEncoder();
          const data = encoder.encode(password);
          const hashBuffer = await crypto.subtle.digest('SHA-256', data);
          // ... تحويل إلى سلسلة نصية
      }
      ```
4.  **إنشاء مستخدم جديد**: يتم إنشاء كائن `User` جديد مع `userId` فريد وكلمة المرور المجزأة.
5.  **التخزين**: يتم إضافة المستخدم الجديد إلى مصفوفة `users` في `localStorage`.
6.  **تسجيل الدخول**: بعد الإنشاء الناجح، يتم تسجيل دخول المستخدم مباشرة عن طريق تعيينه كـ `currentUser`.

### 3. تسجيل الدخول (Login)
1.  **جمع البيانات**: يجمع المكون بيانات الدخول (البريد الإلكتروني/الهاتف وكلمة المرور).
2.  **البحث عن المستخدم**: يتم البحث عن المستخدم في قائمة `users` بناءً على البريد الإلكتروني أو الهاتف.
3.  **التحقق من كلمة المرور**:
    - يتم تجزئة كلمة المرور التي أدخلها المستخدم باستخدام نفس دالة `hashPassword`.
    - تتم مقارنة الهاش الناتج مع `hashedPassword` المخزن للمستخدم.
    - إذا تطابق الهاشان، يكون تسجيل الدخول ناجحًا.
4.  **إدارة الجلسة**: عند نجاح تسجيل الدخول، يتم تخزين كائن المستخدم في `localStorage` تحت مفتاح `'currentUser'`. وجود قيمة في هذا المفتاح هو ما يحدد أن المستخدم مسجل دخوله.

### 4. تسجيل الخروج (Logout)
- عملية تسجيل الخروج بسيطة للغاية: يتم تعيين قيمة `'currentUser'` في `localStorage` إلى `null`.
- هذا يؤدي إلى إعادة عرض `App.tsx` وإظهار شاشة المصادقة مرة أخرى.

## تحذير أمني هام

**هذا النظام غير آمن للتطبيقات الحقيقية.**
- **التجزئة من جانب العميل**: على الرغم من أننا نقوم بتجزئة كلمة المرور، فإن العملية بأكملها تحدث في متصفح المستخدم. يمكن للمستخدمين المتقدمين اعتراض الكود أو تعديله. في التطبيقات الحقيقية، يجب أن تتم عملية التجزئة والتحقق من كلمة المرور على **خادم آمن**.
- **تخزين البيانات**: يمكن لأي شخص لديه وصول إلى المتصفح فتح `localStorage` ورؤية قائمة المستخدمين وكلمات المرور المجزأة.
- **الغرض**: تم تصميم هذا النظام لأغراض تعليمية وتوضيحية فقط، ولتمكين التطبيق من العمل بالكامل بدون خادم.
