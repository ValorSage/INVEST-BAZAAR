# 4. تخزين البيانات (Data Persistence)

## النهج الحالي: الاعتماد على `localStorage`

بما أن هذا التطبيق يعمل بالكامل من جانب العميل (client-side) ولا يتصل بأي خادم، فإننا نعتمد على واجهة برمجة تطبيقات (API) يوفرها المتصفح تسمى **`localStorage`** لتخزين البيانات بشكل دائم.

- `localStorage` هو جزء من "Web Storage API" في المتصفحات الحديثة.
- البيانات المخزنة فيه **تبقى محفوظة** حتى بعد إغلاق المتصفح.
- نحن نستخدم الهوك المخصص `useLocalStorage` لتسهيل التعامل معه.

### المزايا والعيوب للنهج الحالي

#### المزايا:
- **البساطة والسرعة**: لا يتطلب أي إعداد للخادم ويعمل بسرعة.
- **التشغيل بدون اتصال (Offline Functionality)**: التطبيق يعمل بشكل كامل بدون اتصال بالإنترنت.

#### العيوب والقيود:
- **الأمان**: `localStorage` **غير آمن على الإطلاق**. يمكن للمستخدم تعديل بياناته بسهولة.
- **لا للمشاركة**: البيانات مخزنة **فقط في المتصفح الحالي وعلى الجهاز الحالي**. لا يمكن مشاركتها أو مزامنتها.
- **محدودية السعة**: معظم المتصفحات تحدد حجم `localStorage` بحوالي 5-10 ميغابايت.

---

## الخطوة التالية: الانتقال إلى قاعدة بيانات حقيقية

للتغلب على قيود `localStorage` وبناء تطبيق قابل للتطوير وآمن، يجب نقل تخزين البيانات إلى خادم وقاعدة بيانات.

### كيف يعمل النموذج الجديد؟

سيتكون النظام من ثلاثة أجزاء رئيسية:
1.  **العميل (Client)**: واجهة React الأمامية التي يستخدمها المستخدم.
2.  **الخادم (Server / Backend)**: تطبيق يعمل على خادم بعيد (مثل Node.js) يكون مسؤولاً عن منطق الأعمال.
3.  **قاعدة البيانات (Database)**: نظام تخزين متخصص (مثل MongoDB أو PostgreSQL) متصل بالخادم.

**تدفق البيانات سيصبح كالتالي:**

1.  **طلب البيانات**:
    - العميل (الواجهة الأمامية) لم يعد يقرأ من `localStorage`.
    - بدلاً من ذلك، يرسل طلبًا عبر الشبكة (API Request) إلى الخادم. (مثال: `GET /api/user/profile`)
2.  **معالجة الطلب**:
    - الخادم يستقبل الطلب.
    - يتصل بقاعدة البيانات لجلب أو تعديل البيانات المطلوبة.
3.  **إرجاع الاستجابة**:
    - الخادم يرسل البيانات مرة أخرى إلى العميل على شكل استجابة (عادة بصيغة JSON).
4.  **عرض البيانات**:
    - العميل يستقبل الاستجابة ويعرض البيانات للمستخدم.

### لماذا هذا أفضل؟

- **الأمان**: منطق الأعمال الحساس (مثل إضافة النقاط) يتم على الخادم. لا يمكن للمستخدم التلاعب به مباشرة.
- **مصدر الحقيقة الوحيد (Single Source of Truth)**: قاعدة البيانات هي المصدر الموثوق الوحيد للبيانات. هذا يضمن أن جميع المستخدمين على جميع الأجهزة يرون نفس البيانات المحدثة.
- **المشاركة والمزامنة**: يمكن للمستخدم تسجيل الدخول من أي جهاز والوصول إلى نفس بياناته. الميزات مثل الدردشة تصبح ممكنة.
- **قابلية التوسع**: قواعد البيانات مصممة للتعامل مع كميات هائلة من البيانات بكفاءة.

### ماذا يعني هذا للواجهة الأمامية؟

يجب تعديل الواجهة الأمامية للتوقف عن استخدام `useLocalStorage` للبيانات الديناميكية. بدلاً من ذلك، ستقوم بـ:
- **استخدام `fetch` أو مكتبة مثل `axios`** لإرسال طلبات HTTP إلى الخادم. (تم إنشاء مجلد `api` لهذا الغرض).
- **استخدام مكتبة لإدارة حالة الخادم** مثل `React Query` للتعامل مع جلب البيانات وتخزينها مؤقتًا.

للحصول على دليل تفصيلي حول كيفية بناء هذا الخادم وتعديل الواجهة الأمامية، راجع **[دليل تكامل الواجهة الخلفية](./09-backend-integration.md)**.